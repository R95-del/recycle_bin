<% content_for :title, "Recycle Bin" %>

<!-- Statistics Cards -->
<div class="stats">
  <div class="stat-card">
    <div class="stat-number"><%= @deleted_items.count %></div>
    <div class="stat-label">Items in Trash</div>
  </div>

  <div class="stat-card">
    <div class="stat-number"><%= @model_types.count %></div>
    <div class="stat-label">Different Types</div>
  </div>

  <div class="stat-card">
    <div class="stat-number">
      <%= @deleted_items.where('deleted_at > ?', 1.day.ago).count %>
    </div>
    <div class="stat-label">Deleted Today</div>
  </div>
</div>

<!-- Main Content -->
<div class="card">
  <% if @deleted_items.any? %>
    <h2 style="margin-bottom: 1.5rem; color: #495057;">
      Deleted Items
      <span style="font-size: 0.8em; color: #6c757d;">
        (<%= @deleted_items.count %> items)
      </span>
    </h2>

    <!-- Model Type Filter -->
    <div style="margin-bottom: 1.5rem;">
      <strong>Filter by type:</strong>
      <%= link_to "All", recycle_bin.trash_index_path,
                  class: "btn btn-sm #{'btn-primary' if params[:type].blank?}" %>
      <% @model_types.each do |model_type| %>
        <%= link_to model_type, recycle_bin.trash_index_path(type: model_type),
                    class: "btn btn-sm #{'btn-primary' if params[:type] == model_type}" %>
      <% end %>
    </div>

    <!-- Items Table -->
    <table class="table">
      <thead>
        <tr>
          <th>Type</th>
          <th>Title</th>
          <th>Deleted At</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @deleted_items.each do |item| %>
          <tr>
            <td>
              <strong><%= item.class.name %></strong>
            </td>
            <td>
              <%= link_to truncate(item.recyclable_title, length: 50),
                          recycle_bin.trash_path(item),
                          style: "text-decoration: none; color: #007bff;" %>
            </td>
            <td>
              <span style="color: #6c757d;">
                <%= time_ago_in_words(item.deleted_at) %> ago
              </span>
              <br>
              <small style="color: #adb5bd;">
                <%= item.deleted_at.strftime('%B %d, %Y at %I:%M %p') %>
              </small>
            </td>
            <td>
              <%= link_to "View", recycle_bin.trash_path(item),
                          class: "btn btn-sm btn-primary" %>
              <%= link_to "Restore", recycle_bin.restore_trash_path(item),
                          method: :patch,
                          class: "btn btn-sm btn-success",
                          data: {
                            confirm: "Are you sure you want to restore this #{item.class.name.downcase}?"
                          } %>
              <%= link_to "Delete Forever", recycle_bin.trash_path(item),
                          method: :delete,
                          class: "btn btn-sm btn-danger",
                          data: {
                            confirm: "This will permanently delete this #{item.class.name.downcase}. This action cannot be undone!"
                          } %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <!-- Bulk Actions -->
    <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #dee2e6;">
      <p style="color: #6c757d; font-size: 0.875rem;">
        <strong>Bulk Actions:</strong>
        Select items above to restore or delete multiple items at once.
        <em>(Coming in v1.1)</em>
      </p>
    </div>

  <% else %>
    <!-- Empty State -->
    <div class="empty-state">
      <div class="empty-state-icon">ðŸŽ‰</div>
      <h3>Your trash is empty!</h3>
      <p>When you delete items from your application, they'll appear here so you can restore them if needed.</p>

      <div style="margin-top: 2rem;">
        <h4 style="color: #495057;">How to use RecycleBin:</h4>
        <div style="text-align: left; max-width: 500px; margin: 1rem auto;">
          <p><strong>1.</strong> Add <code>include RecycleBin::SoftDeletable</code> to your models</p>
          <p><strong>2.</strong> Add <code>deleted_at:datetime</code> column to your tables</p>
          <p><strong>3.</strong> Call <code>.destroy</code> on records - they'll come here instead of being deleted</p>
          <p><strong>4.</strong> Use <code>.restore</code> to bring them back</p>
        </div>
      </div>
    </div>
  <% end %>
</div>

<!-- Help Section -->
<div class="card" style="margin-top: 2rem; background: #f8f9fa;">
  <h4 style="color: #495057; margin-bottom: 1rem;">ðŸ’¡ Pro Tips</h4>
  <ul style="color: #6c757d; line-height: 1.8;">
    <li><strong>Restore:</strong> Click "Restore" to bring items back to your application</li>
    <li><strong>Permanent Delete:</strong> "Delete Forever" removes items completely (cannot be undone)</li>
    <li><strong>Auto-cleanup:</strong> Items older than 30 days are automatically cleaned up</li>
    <li><strong>Search:</strong> Use your browser's find (Ctrl/Cmd+F) to search this page</li>
  </ul>
</div>
